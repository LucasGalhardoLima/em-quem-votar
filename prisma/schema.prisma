generator client {
  provider = "prisma-client-js"
}

datasource db {
  provider  = "postgresql"
  url       = env("DATABASE_URL")
  directUrl = env("DIRECT_URL")
}

model Politician {
  id        String   @id @default(uuid())
  name      String
  party     String   // Sigla do partido
  state     String   // UF
  photoUrl  String?
  
  // Métricas do "Produto"
  attendanceRate Float?   // Assiduidade (0-100)
  spending       Decimal? // Gasto total
  
  // Relacionamentos
  votes     VoteLog[]
  tags      PoliticianTag[] // Tags atribuídas (ex: "Liberal", "Conservador")

  createdAt DateTime @default(now())
  updatedAt DateTime @updatedAt

  @@index([name])
  @@index([party])
  @@index([state])
  @@index([state, party]) // Optimization for combined filters
}

// As "Categorias" do seu e-commerce
model Tag {
  id          String   @id @default(uuid())
  name        String   // Ex: "A favor do Aborto"
  category    String   // Ex: "Costumes", "Economia"
  slug        String   @unique // Para usar na URL
  
  politicians PoliticianTag[]
}

// Tabela Pivô (Many-to-Many explícito para poder adicionar metadados se precisar)
model PoliticianTag {
  politicianId String
  tagId        String
  
  politician   Politician @relation(fields: [politicianId], references: [id])
  tag          Tag        @relation(fields: [tagId], references: [id])

  @@id([politicianId, tagId])
  @@index([tagId])
  @@index([politicianId])
}

// Histórico de Votações (A fonte da verdade)
model Bill {
  id          String   @id // ID da API da Camara
  title       String
  description String?
  voteSimDetails String?
  voteNaoDetails String?
  voteDate    DateTime
  
  // Campos para workflow de aprovação
  status          String   @default("approved") // pending, approved, rejected
  aiConfidence    Float?   // 0-100, confiança da classificação
  suggestedTagSim String?  // Tag sugerida pela IA para voto SIM
  suggestedTagNao String?  // Tag sugerida pela IA para voto NÃO
  suggestedCategory String? // Categoria sugerida
  approvedAt      DateTime?
  lastSyncAt      DateTime?
  
  // Linguagem simplificada gerada por IA
  simplifiedTitle       String? // Título em linguagem clara
  simplifiedDescription String? @db.Text // Explicação em linguagem acessível
  
  // Link para fonte original
  sourceUrl             String? // URL da votação na Câmara
  
  voteLogs    VoteLog[]

  @@index([voteDate])
  @@index([status])
  @@unique([id])
}

model VoteLog {
  id           String @id @default(uuid())
  politicianId String
  billId       String
  voteType     String // "Sim", "Não", "Obstrução", "Abstenção"

  politician   Politician @relation(fields: [politicianId], references: [id])
  bill         Bill       @relation(fields: [billId], references: [id])

  @@index([politicianId])
  @@index([billId])
  @@unique([politicianId, billId])
}

model Subscriber {
  id        String   @id @default(uuid())
  email     String   @unique
  createdAt DateTime @default(now())
}

model UserProfile {
  id              String   @id @default(uuid()) // Linked to Supabase Auth ID
  email           String   @unique
  name            String?
  photoUrl        String?
  
  // Perfil Político
  quizAnswers     Json?    // Respostas cruas do quiz
  politicalVector Json?    // Vetor calculado de afinidade
  
  createdAt       DateTime @default(now())
  updatedAt       DateTime @updatedAt
}
